const m=document.documentElement,c=document.getElementById("theme-toggle"),M=window.matchMedia("(prefers-color-scheme: dark)"),S=e=>{e?m.setAttribute("data-theme",e):m.removeAttribute("data-theme")},w=e=>{if(!(c instanceof HTMLButtonElement))return;const t=e?"Light mode":"Dark mode";c.textContent=t,c.setAttribute("aria-label",`Switch to ${e?"light":"dark"} mode`),c.setAttribute("title",`Switch to ${e?"light":"dark"} mode`),c.setAttribute("aria-pressed",String(e))},v=()=>{try{return localStorage.getItem("theme")}catch{return null}},I=e=>{try{localStorage.setItem("theme",e)}catch{return}},x=v(),k=x||(M.matches?"dark":"light");S(x);w(k==="dark");c instanceof HTMLButtonElement&&c.addEventListener("click",()=>{const t=(m.getAttribute("data-theme")||k)==="dark"?"light":"dark";m.setAttribute("data-theme",t),I(t),w(t==="dark")});M.addEventListener("change",e=>{v()||(S(null),w(e.matches))});const C=()=>{const e=navigator.userAgent||"",t=/Mac/i.test(e),o=/Windows/i.test(e),n=/Linux/i.test(e)&&!/Android/i.test(e);return t?"macos":o?"windows":n?"linux":"unknown"},B=e=>e==="windows"?"Windows":e==="linux"?"Linux":"MacOS",P=()=>{const e=C(),t=B(e),o=document.querySelectorAll("[data-platform-label]"),n=document.querySelectorAll("[data-platform-download]");o.forEach(r=>{r instanceof HTMLElement&&(r.textContent=`Moose for ${t}`)}),n.forEach(r=>{r instanceof HTMLElement&&(r.textContent=`Download Moose for ${t}`)})},O=()=>{const e=document.querySelector(".download-grid");if(!(e instanceof HTMLElement))return;const t=Array.from(e.querySelectorAll(".download-card"));if(t.length<2)return;const o=C(),n=o==="unknown"?"macos":o,r=t.find(a=>a.getAttribute("data-os")===n);if(!r)return;t.forEach(a=>a.classList.remove("is-featured")),r.classList.add("is-featured"),[r,...t.filter(a=>a!==r)].forEach(a=>e.appendChild(a)),e.classList.add("is-reordered")};O();P();const N=async()=>{const e=Array.from(document.querySelectorAll("[data-version]")).filter(t=>t instanceof HTMLElement);if(e.length){e.forEach(t=>{t.style.display="none"});try{const t=await fetch("https://assets.moosebrowser.com/browser/version.txt",{cache:"no-store"});if(!t.ok)return;const o=(await t.text()).trim();if(!o)return;e.forEach(n=>{n.textContent=o,n.style.display="",n.removeAttribute("aria-hidden")})}catch{return}}};N();const f=new Set,p=window.matchMedia("(prefers-reduced-motion: reduce)"),h="IntersectionObserver"in window?new IntersectionObserver(e=>{e.forEach(t=>{const o=t.target;if(o instanceof HTMLVideoElement){if(p.matches){o.pause();return}if(t.isIntersecting){o.preload!=="metadata"&&(o.preload="metadata");const n=o.play();n&&typeof n.catch=="function"&&n.catch(()=>{})}else o.pause()}})},{rootMargin:"200px 0px"}):null,q=(e=document)=>{Array.from(e.querySelectorAll("[data-demo-video]")).filter(o=>o instanceof HTMLVideoElement).forEach(o=>{if(!f.has(o)){if(f.add(o),o.preload="none",p.matches){o.pause();return}if(h)h.observe(o);else{const n=o.play();n&&typeof n.catch=="function"&&n.catch(()=>{})}}})};q();window.mooseRefreshDemoVideos=q;p.addEventListener("change",()=>{if(p.matches){f.forEach(e=>e.pause());return}f.forEach(e=>{if(h)h.observe(e);else{const t=e.play();t&&typeof t.catch=="function"&&t.catch(()=>{})}})});const V=Array.from(document.querySelectorAll("[data-popup]")),j=Array.from(document.querySelectorAll("[data-popup-trigger]")),D=Array.from(document.querySelectorAll("[data-popup-close]"));let g=null,d=null;const W=e=>{if(!(e instanceof HTMLElement))return;g=document.activeElement,d=e,e.hidden=!1,requestAnimationFrame(()=>e.classList.add("is-open")),document.body.style.overflow="hidden";const t=e.querySelector("[data-popup-focus]");t instanceof HTMLInputElement&&t.focus()},H=e=>{e instanceof HTMLElement&&(e.classList.remove("is-open"),e.addEventListener("transitionend",()=>{e.hidden=!0},{once:!0}),document.body.style.overflow="",g instanceof HTMLElement&&g.focus(),d===e&&(d=null))},$=e=>V.find(t=>t.getAttribute("data-popup")===e)||null;j.forEach(e=>{const t=e.getAttribute("data-popup-trigger");if(!t)return;const o=$(t);o&&e.addEventListener("click",()=>W(o))});D.forEach(e=>{e.addEventListener("click",()=>{const t=e.closest("[data-popup]");t instanceof HTMLElement&&H(t)})});window.addEventListener("keydown",e=>{e.key==="Escape"&&d&&!d.hidden&&H(d)});const A=(e,t,o)=>{e.textContent="";const n=document.createTextNode(t||"");if(e.append(n),o){e.append(" ");const r=document.createElement("code");r.className="license-code",r.textContent=o,e.append(r),e.append(" ");const s=document.createElement("button");s.type="button",s.className="license-copy",s.textContent="copy",s.setAttribute("aria-label","Copy license"),s.addEventListener("click",async()=>{try{await navigator.clipboard.writeText(o),s.textContent="copied",window.setTimeout(()=>{s.textContent="copy"},1600)}catch{s.textContent="failed",window.setTimeout(()=>{s.textContent="copy"},1600)}}),e.append(s)}},b=e=>{const{form:t,emailInput:o,statusElement:n,endpoint:r,successMessage:s}=e;t instanceof HTMLFormElement&&o instanceof HTMLInputElement&&n instanceof HTMLElement&&t.addEventListener("submit",async a=>{a.preventDefault();const E=o.value.trim();if(!E)return;n.textContent="Submitting...",o.disabled=!0;const L=t.querySelector('button[type="submit"]'),u=L instanceof HTMLButtonElement?L:null;u&&(u.disabled=!0);try{const l=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:E})});if(!l.ok){const y=await l.json().catch(()=>null),T=y&&typeof y.error=="string"?y.error.trim():"";n.textContent=T||"Something went wrong. Please try again.";return}const i=typeof s=="function"?await s(l):s;i&&typeof i=="object"?A(n,i.message||"",i.license||""):A(n,typeof i=="string"?i:"",""),t.reset()}catch{n.textContent="Something went wrong. Please try again."}finally{o.disabled=!1,u&&(u.disabled=!1)}})};b({form:document.querySelector("[data-footer-form]"),emailInput:document.getElementById("footer-email"),statusElement:document.querySelector("[data-footer-status]"),endpoint:"https://api.flowmitry.com/webhook/moose/subscribe-product-updates",successMessage:"Thanks! You are subscribed to product updates."});b({form:document.querySelector("[data-beta-form]"),emailInput:document.getElementById("beta-email"),statusElement:document.querySelector("[data-beta-status]"),endpoint:"https://api.flowmitry.com/webhook/moose/join-beta",successMessage:async e=>{const t=await e.json().catch(()=>null),o=t&&typeof t.license=="string"?t.license.trim():"";return o?{message:"Thanks! Your license:",license:o}:"Thanks! We will email you when your spot opens."}});b({form:document.querySelector("[data-product-updates-form]"),emailInput:document.getElementById("product-updates-email"),statusElement:document.querySelector("[data-product-updates-status]"),endpoint:"https://api.flowmitry.com/webhook/moose/subscribe-product-updates",successMessage:"Thanks! You are subscribed to product updates."});
